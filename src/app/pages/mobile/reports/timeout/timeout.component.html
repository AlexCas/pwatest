<div *ngIf="tmData" class="row">
  <div class="col-12">
    <app-tv-header title="Tiempo Muerto" backButton="/"></app-tv-header>
  </div>
  <div class="col-12">
    <mat-accordion>
      <mat-expansion-panel
        class="expansion-panel"
        [expanded]="filterOpen"
        (opened)="filterOpen = true"
        (closed)="filterOpen = false"
      >
        <mat-expansion-panel-header class="expansion-header">
          Filtros
        </mat-expansion-panel-header>
        <form
          [formGroup]="form"
          (ngSubmit)="onSubmit()"
          *ngIf="rolePermissionsData && !machinesSwitch"
        >
          <div class="row">
            <div class="col-12">
              <mat-form-field class="w-100" appearance="standard">
                <mat-label>Planta</mat-label>
                <mat-select
                  formControlName="factoryId"
                  (selectionChange)="onFactoryChange($event)"
                  required
                >
                  <mat-option
                    *ngFor="let item of rolePermissionsData.factories"
                    [value]="item"
                  >
                    {{ item?.factoryName }}
                  </mat-option>
                </mat-select>
                <mat-error> {{ appMessage.FIELD_REQUIRED }} </mat-error>
              </mat-form-field>
            </div>
            <div class="col-12" *ngIf="factorySelected">
              <mat-form-field class="w-100" appearance="standard">
                <mat-label>Nave</mat-label>
                <mat-select
                  formControlName="warehouseId"
                  (selectionChange)="onWarehouseChange()"
                  required
                >
                  <mat-option
                    *ngFor="let item of factorySelected.warehouses"
                    [value]="item.warehouseId"
                  >
                    {{ item?.warehouseName }}
                  </mat-option>
                </mat-select>
                <mat-error> {{ appMessage.FIELD_REQUIRED }} </mat-error>
              </mat-form-field>
            </div>
            <mat-divider class="mb-3"></mat-divider>
            <div class="col-6">
              <mat-form-field appearance="fill" class="oee-field">
                <mat-label>Fecha Inicio:</mat-label>
                <input
                  formControlName="startDate"
                  matInput
                  [matDatepicker]="startDate"
                />
                <mat-error> {{ appMessage.FIELD_REQUIRED }} </mat-error>
                <mat-datepicker-toggle
                  matSuffix
                  [for]="startDate"
                ></mat-datepicker-toggle>
                <mat-datepicker #startDate></mat-datepicker>
              </mat-form-field>
            </div>
            <div class="col-6">
              <mat-form-field appearance="fill" class="oee-field">
                <mat-label>Fecha Fin:</mat-label>
                <input
                  formControlName="endDate"
                  matInput
                  [matDatepicker]="endDate"
                />
                <mat-error> {{ appMessage.FIELD_REQUIRED }} </mat-error>
                <mat-datepicker-toggle
                  matSuffix
                  [for]="endDate"
                ></mat-datepicker-toggle>
                <mat-datepicker #endDate></mat-datepicker>
              </mat-form-field>
            </div>
            <mat-divider></mat-divider>
            <div class="col-6 my-3 text-left">
              <span class="machine-title-form">Máquina</span>
            </div>
            <div class="col-6 my-3 text-end" (click)="switchMachine()">
              <span class="aligned-with-icon">{{
                machineSelected.length > 0
                  ? machineSelected[0].machine +
                    " - " +
                    machineSelected[machineSelected.length - 1].machine
                  : "Seleccionar"
              }}</span>
              <mat-icon>keyboard_arrow_right</mat-icon>
            </div>
            <mat-divider></mat-divider>
            <div class="col-6">
              <div class="my-3 text-center">
                <button
                  (click)="cleanValues($event)"
                  color="secondary"
                  mat-raised-button
                >
                  <mat-icon>clear</mat-icon>
                  <span> Limpiar</span>
                </button>
              </div>
            </div>
            <div class="col-6">
              <div class="my-3 text-center">
                <button type="submit" color="primary" mat-raised-button>
                  <mat-icon>search</mat-icon>
                  <span> Buscar</span>
                </button>
              </div>
            </div>
          </div>
        </form>
        <div class="row" *ngIf="machinesSwitch">
          <div
            (click)="backToForm($event)"
            class="col-12 d-flex justify-content-between machine-title"
          >
            <mat-icon>keyboard_arrow_left</mat-icon>
            <span>Seleccionar Máquina</span>
          </div>
          <div class="col-12">
            <li class="machine-item">
              <mat-checkbox
                [checked]="selectedAllMachines"
                (change)="selectAllMachines()"
              >
                Seleccionar Todas
              </mat-checkbox>
            </li>
            <li class="machine-item" *ngFor="let machine of machineList">
              <mat-checkbox
                [checked]="checkMachine(machine)"
                (change)="selectMachine(machine, $event.checked)"
              >
                {{ machine.machine }}
              </mat-checkbox>
            </li>
          </div>
          <div class="col-6">
            <div class="my-3 text-center">
              <button
                (click)="cleanMachines($event)"
                color="secondary"
                mat-raised-button
              >
                <span> Limpiar</span>
              </button>
            </div>
          </div>
          <div class="col-6">
            <div class="my-3 text-center">
              <button
                (click)="backToForm($event)"
                color="primary"
                mat-raised-button
              >
                <span> Aceptar</span>
              </button>
            </div>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <div class="col-12">
    <div class="title-content text-center">
      <span class="title">{{ tmData.warehouse.name }}</span>
    </div>
    <div class="title-content text-center">
      <span class="title"
        >Top 10 de Tiempo Muerto vs Tiempo Real de Corrida Semanal por
        Máquina</span
      >
    </div>
  </div>

  <div class="trcvstm-warehouse">
    <div class="ifFound" *ngIf="tmData.warehouse.trcItems.length > 0">
      <app-trcvstm-mobile
        [chartOptions]="chartOptionsWarehouseTRTM"
        [landscape]="landscape"
        [loadChart]="loadChart"
      ></app-trcvstm-mobile>

      <div class="col-12">
        <div class="title-content text-center">
          <mat-slide-toggle
            [(ngModel)]="trcWarehouseChecked"
            class="title"
            color="primary"
            >Detalle</mat-slide-toggle
          >
        </div>
      </div>
      <div class="col-12" *ngIf="trcWarehouseChecked">
        <app-trcvstm-table
          [data]="tmData.warehouse.trcItems"
          [name]="tmData.warehouse.name"
          [columns]="columns"
        ></app-trcvstm-table>
      </div>
    </div>
    <div
      class="notFound text-center"
      *ngIf="tmData.warehouse.trcItems.length == 0"
    >
      No se encontraron registros.
    </div>
  </div>
  <div class="col-12">
    <div class="title-content text-center">
      <span class="title">{{ tmData.warehouse.name }}</span>
    </div>
    <div class="title-content text-center">
      <span class="title">Top 6 de Tiempo Muerto por Máquina - Causa</span>
    </div>
  </div>
  <div class="tm-warehouse">
    <div *ngIf="tmData.warehouse.items.length > 0" class="ifFound">
      <app-trcvstm-mobile
        [chartOptions]="chartOptionsWarehouseTM"
        [landscape]="landscape"
        [loadChart]="loadChart"
      ></app-trcvstm-mobile>

      <div class="col-12">
        <div class="title-content text-center">
          <mat-slide-toggle
            [(ngModel)]="codigoWarehouseChecked"
            class="title"
            color="primary"
            >Detalle</mat-slide-toggle
          >
        </div>
      </div>
      <div class="col-12" *ngIf="codigoWarehouseChecked">
        <app-trcvstm-table
          [data]="tmData.warehouse.items"
          [name]="tmData.warehouse.name"
          [columns]="columnsWarehouseTm"
        ></app-trcvstm-table>
      </div>
    </div>
    <div
      class="notFound text-center"
      *ngIf="tmData.warehouse.items.length == 0"
    >
      No se encontraron registros.
    </div>
  </div>

  <div class="col-12">
    <div class="title-content text-center">
      <span class="title">Total Planta {{ tmData.factory }}</span>
    </div>
    <div class="title-content text-center">
      <span class="title"
        >Top 10 de Tiempo Muerto vs Tiempo Real de Corrida Semanal por
        Máquina</span
      >
    </div>
  </div>

  <div class="trcvstm-factory">
    <div class="ifFound" *ngIf="tmData.trcItems.length > 0">
      <app-trcvstm-mobile
        [chartOptions]="chartOptionsFactoryTRTM"
        [landscape]="landscape"
        [loadChart]="loadChart"
      ></app-trcvstm-mobile>

      <div class="col-12">
        <div class="title-content text-center">
          <mat-slide-toggle
            [(ngModel)]="trcFactoryChecked"
            class="title"
            color="primary"
            >Detalle</mat-slide-toggle
          >
        </div>
      </div>
      <div class="col-12" *ngIf="trcFactoryChecked">
        <app-trcvstm-table
          [data]="tmData.trcItems"
          [name]="'factory'"
          [columns]="columns"
        ></app-trcvstm-table>
      </div>
    </div>
    <div class="notFound text-center" *ngIf="tmData.trcItems.length == 0">
      No se encontraron registros.
    </div>
  </div>

  <div class="col-12">
    <div class="title-content text-center">
      <span class="title">Total Planta {{ tmData.factory }}</span>
    </div>
    <div class="title-content text-center">
      <span class="title">Top 6 de Tiempo Muerto por Máquina - Causa</span>
    </div>
  </div>

  <div class="trcvstm-factory">
    <div class="ifFound" *ngIf="tmData.items.length > 0">
      <app-trcvstm-mobile
        [chartOptions]="chartOptionsFactoryTM"
        [landscape]="landscape"
        [loadChart]="loadChart"
      ></app-trcvstm-mobile>

      <div class="col-12">
        <div class="title-content text-center">
          <mat-slide-toggle
            [(ngModel)]="codigoFactoryChecked"
            class="title"
            color="primary"
            >Detalle</mat-slide-toggle
          >
        </div>
      </div>
      <div class="col-12" *ngIf="codigoFactoryChecked">
        <app-trcvstm-table
          [data]="tmData.items"
          [name]="'factory'"
          [columns]="columnsWarehouseTm"
        ></app-trcvstm-table>
      </div>
    </div>
    <div class="notFound text-center" *ngIf="tmData.items.length == 0">
      No se encontraron registros.
    </div>
  </div>
</div>
