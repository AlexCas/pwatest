<div class="row" *ngIf="alertsData">
  <div class="col-12">
    <app-tv-header title="Alertas de Calidad" backButton="/"></app-tv-header>
  </div>
  <div class="col-12" *ngIf="showCarrousel">
    <mat-accordion>
      <mat-expansion-panel
        class="expansion-panel"
        [expanded]="carouselConfig"
        (opened)="carouselConfig = true"
        (closed)="carouselConfig = false"
      >
        <mat-expansion-panel-header class="expansion-header"
          >Configuracion de Carrusel
        </mat-expansion-panel-header>
        <app-carousel-config [reportName]="reportName"></app-carousel-config>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <div class="col-12 mt-2">
    <mat-accordion>
      <mat-expansion-panel
        class="expansion-panel"
        [expanded]="filterOpen"
        (opened)="filterOpen = true"
        (closed)="filterOpen = false"
      >
        <mat-expansion-panel-header class="expansion-header"
          >Filtros
        </mat-expansion-panel-header>
        <form
          [formGroup]="form"
          (ngSubmit)="onSubmit()"
          *ngIf="rolePermissionsData && !alertsSwitch"
        >
          <div class="row" *ngIf="rolePermissionsData">
            <div class="col-12">
              <mat-form-field class="w-100" appearance="standard">
                <mat-label>Planta</mat-label>
                <mat-select
                  formControlName="factoryId"
                  (selectionChange)="onFactoryChange($event)"
                  required
                >
                  <mat-option
                    *ngFor="let item of rolePermissionsData.factories"
                    [value]="item"
                  >
                    {{ item?.factoryName }}
                  </mat-option>
                </mat-select>
                <mat-error> {{ appMessage.FIELD_REQUIRED }} </mat-error>
              </mat-form-field>
            </div>
            <div class="col-12" *ngIf="factorySelected">
              <mat-form-field class="w-100" appearance="standard">
                <mat-label>Nave</mat-label>
                <mat-select formControlName="warehouseId" required>
                  <mat-option
                    *ngFor="let item of factorySelected.warehouses"
                    [value]="item.warehouseId"
                  >
                    {{ item?.warehouseName }}
                  </mat-option>
                </mat-select>
                <mat-error> {{ appMessage.FIELD_REQUIRED }} </mat-error>
              </mat-form-field>
            </div>
            <mat-divider class="mb-3"></mat-divider>
            <div class="col-6">
              <mat-form-field appearance="fill" class="oee-field">
                <mat-label>Fecha Inicio:</mat-label>
                <input
                  formControlName="startDate"
                  matInput
                  [matDatepicker]="startDate"
                />
                <mat-error> {{ appMessage.FIELD_REQUIRED }} </mat-error>
                <mat-datepicker-toggle
                  matSuffix
                  [for]="startDate"
                ></mat-datepicker-toggle>
                <mat-datepicker #startDate></mat-datepicker>
              </mat-form-field>
            </div>
            <div class="col-6">
              <mat-form-field appearance="fill" class="oee-field">
                <mat-label>Fecha Fin:</mat-label>
                <input
                  formControlName="endDate"
                  matInput
                  [matDatepicker]="endDate"
                />
                <mat-error> {{ appMessage.FIELD_REQUIRED }} </mat-error>
                <mat-datepicker-toggle
                  matSuffix
                  [for]="endDate"
                ></mat-datepicker-toggle>
                <mat-datepicker #endDate></mat-datepicker>
              </mat-form-field>
            </div>
            <mat-divider></mat-divider>
            <div class="col-6 my-3 text-left">
              <span class="machine-title-form">Tipo de Alerta</span>
            </div>
            <div class="col-6 my-3 text-end" (click)="switchAlerts()">
              <span class="aligned-with-icon">{{
                alertTypesSelected.length > 0
                  ? alertTypesSelected[0].name +
                    " - " +
                    alertTypesSelected[alertTypesSelected.length - 1].name
                  : "Seleccionar"
              }}</span>
              <mat-icon>keyboard_arrow_right</mat-icon>
            </div>
            <mat-divider></mat-divider>
            <div class="col-6">
              <div class="my-3 text-center">
                <button
                  (click)="cleanValues($event)"
                  color="secondary"
                  mat-raised-button
                >
                  <mat-icon>clear</mat-icon>
                  <span> Limpiar</span>
                </button>
              </div>
            </div>
            <div class="col-6">
              <div class="my-3 text-center">
                <button type="submit" color="primary" mat-raised-button>
                  <mat-icon>search</mat-icon>
                  <span> Buscar</span>
                </button>
              </div>
            </div>
          </div>
        </form>
        <div class="row" *ngIf="alertsSwitch">
          <div
            (click)="backToForm($event)"
            class="col-12 d-flex justify-content-between machine-title"
          >
            <mat-icon>keyboard_arrow_left</mat-icon>
            <span>Seleccionar Tipo de Alerta</span>
          </div>
          <div class="col-12">
            <li class="machine-item">
              <mat-checkbox
                [checked]="selectedAllAlerts"
                (change)="selectAllAlerts()"
              >
                Seleccionar Todas
              </mat-checkbox>
            </li>
            <li class="machine-item" *ngFor="let alert of alertTypes">
              <mat-checkbox
                [checked]="checkAlert(alert)"
                (change)="selectAlerts(alert, $event.checked)"
              >
                {{ alert.name }}
              </mat-checkbox>
            </li>
          </div>
          <div class="col-6">
            <div class="my-3 text-center">
              <button
                (click)="cleanAlerts($event)"
                color="secondary"
                mat-raised-button
              >
                <span> Limpiar</span>
              </button>
            </div>
          </div>
          <div class="col-6">
            <div class="my-3 text-center">
              <button
                (click)="backToForm($event)"
                color="primary"
                mat-raised-button
              >
                <span> Aceptar</span>
              </button>
            </div>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <div *ngIf="alertsData">
    <div class="title-content text-center">
      <span class="title"
        >Planta {{ getFactoryName() }} - {{ getWarehouseName() }}</span
      >
    </div>
    <div class="row" *ngIf="alertsData.length == 0">
      <div class="col-12 text-center">No se encontraron registros</div>
    </div>
    <div class="col-12" *ngFor="let alert of alertsData">
      <embed
        [src]="
          sanitizeUrl(
            'https://drive.google.com/viewerng/viewer?embedded=true&url=' +
              appUrl +
              '/' +
              alert.fileRoot +
              '/' +
              alert.fileName +
              '#view=fitH&toolbar=0&navpanes=0'
          )
        "
        class="pdf-viewer"
      />
      <mat-divider></mat-divider>
    </div>
  </div>
</div>
