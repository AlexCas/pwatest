<div class="padding">
  <app-breadcrumbs [current]="title"></app-breadcrumbs>
  <mat-card class="mt-3">
    <mat-card-header>
      <div fxLayout="row" fxLayoutAlign="space-between center">
        <div fxLayout="row" fxLayoutAlign="center center" class="mb-3">
          <mat-icon class="me-2">people_alt</mat-icon>
          <h3>{{title}}</h3>
        </div>
      </div>
    </mat-card-header>
    <mat-divider></mat-divider>
    <mat-card-content class="pt-2">
      <div class="row" hidden>
        <div class="col-12 col-sm-8 offset-sm-2 col-md-4 offset-md-4 text-center mt-3">
          <mat-form-field fxFlex="grow" appearance="outline">
            <mat-label>Búsqueda por nombre</mat-label>
            <input matInput maxlength="50">
            <mat-icon matPrefix>search</mat-icon>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-md-3">
          <div class="d-flex align-items-center h-100 justify-content-end pt-3">
            <mat-form-field fxFlex="grow" appearance="outline">
              <mat-label>Búsqueda por nombre</mat-label>
              <input matInput maxlength="50" [(ngModel)]="objFilter.searchTerm">
              <button *ngIf="objFilter.searchTerm" matSuffix mat-icon-button aria-label="Clear"
                (click)="objFilter.searchTerm=''; onSearch()">
                <mat-icon>close</mat-icon>
              </button>
              <button matSuffix mat-icon-button type="button" color="primary" (click)="onSearch()">
                <mat-icon>search</mat-icon>
              </button>
            </mat-form-field>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="d-flex align-items-center h-100 justify-content-center pt-3">
            <mat-form-field appearance="outline" class="mx-1">
              <mat-label>Planta:</mat-label>
              <mat-select>
                <mat-option (onSelectionChange)="onFactoryChange($event)">Todos</mat-option>
                <mat-option *ngFor="let item of factoryDataSource" [value]="item.id"
                  (onSelectionChange)="onFactoryChange($event)">
                  {{item?.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="mx-1">
              <mat-label>Departamento</mat-label>
              <mat-select>
                <mat-option (onSelectionChange)="onDepartmentChange($event)">Todos</mat-option>
                <mat-option *ngFor="let item of departmentDataSource" [value]="item.id"
                  (onSelectionChange)="onDepartmentChange($event)">
                  {{item?.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="d-flex align-items-center h-100 justify-content-end">
            <mat-icon [matMenuTriggerFor]="filterMenu" class="filter-icon me-3">filter_alt</mat-icon>
            <button mat-raised-button color="primary" [routerLink]="['/users/add']">
              <mat-icon>add</mat-icon>
              <span>Registrar Usuario</span>
            </button>
          </div>
          <mat-menu #filterMenu="matMenu" xPosition="before">
            <button mat-menu-item (click)="onFilterChange()">Todos</button>
            <button mat-menu-item (click)="onFilterChange(1)">Activo</button>
            <button mat-menu-item (click)="onFilterChange(0)">Inactivo</button>
          </mat-menu>
        </div>
      </div>

      <div class="mat-elevation-z1 mt-4">

        <mtx-grid [data]="users" [columns]="columns" [length]="length" [pageOnFront]="false"
          [noResultText]="noResultText" [cellTemplate]="{name: nameTpl, status: statusTpl, isActive: isActiveTpl}"
          [pageIndex]="query.pageIndex" [pageSize]="query.pageSize" [pageSizeOptions]="pageSizeOptions"
          (page)="getNextPage($event)">

          <ng-template #nameTpl let-row let-index="index" let-col="colDef">
            <button mat-button color="primary" [routerLink]="['/users/edit/' + row.id ]">{{row?.name}}</button>
          </ng-template>
          <ng-template #statusTpl let-row let-index="index" let-col="colDef">
            {{row?.isActive ? 'Activo': 'Inactivo'}}
          </ng-template>
          <ng-template #isActiveTpl let-row let-index="index" let-col="colDef">
            <mat-slide-toggle [(ngModel)]="row.isActive" [checked]="row.isActive" (change)="updateStatus($event, row)">
            </mat-slide-toggle>
          </ng-template>

        </mtx-grid>

      </div>
    </mat-card-content>
  </mat-card>
</div>
