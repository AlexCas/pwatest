<div class="page-container">  
  <div fxLayout="column" fxLayoutAlign="start center">
    <div fxLayout="row" fxLayoutAlign="start center" style="width: 100%">      
      <button mat-button routerLink="/devices" class="my-3" color="primary">
        <mat-icon>keyboard_backspace</mat-icon>
        Regresar
      </button>
    </div>
    <mat-card class="mat-elevation-z4 mb-3 w-100">
      <mat-card-header>
        <mat-card-title class="form-title">{{ title }}</mat-card-title>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content>
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="row">
            <div class="col-12 col-md-6" [hidden]="!isEdit">
              <mat-form-field fxFlex="grow" appearance="standard">
                <mat-label>ID Dispositivo</mat-label>
                <input formControlName="sId" matInput />
              </mat-form-field>
            </div>
            <div class="col-12 col-md-6" [hidden]="!isEdit">
              <mat-form-field fxFlex="grow" appearance="standard">
                <mat-label>Nombre</mat-label>
                <input formControlName="name" matInput required />
                <mat-error> {{appMessage.FIELD_REQUIRED}} </mat-error>
              </mat-form-field>
            </div>
            <div class="col-12 col-md-6">
              <mat-form-field fxFlex="grow" appearance="standard">
                <mat-label>IP</mat-label>
                <input [dropSpecialCharacters]="false" mask="IP" formControlName="ipAddress" (ngModelChange)="isEqual()" matInput required />
                <mat-error> {{appMessage.FIELD_REQUIRED}} </mat-error>
              </mat-form-field>
            </div>

            <div class="col-12 col-md-6">
              <div class="d-flex">
                <button
                  mat-icon-button
                  matPrefix
                  color="primary"
                  (click)="factoryNew($event)"
                >
                  <mat-icon>add</mat-icon>
                </button>
                <mat-form-field class="w-100" appearance="standard">
                  <mat-label>Planta</mat-label>
                  <mat-select
                    formControlName="factoryId"
                    (selectionChange)="onFactoryChange($event)"
                    required
                  >
                    <mat-option
                      *ngFor="let item of factoryDataSource"
                      [value]="item.id"
                    >
                      {{ item?.name }}
                    </mat-option>
                  </mat-select>
                  <mat-error> {{appMessage.FIELD_REQUIRED}} </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <mat-slide-toggle
                formControlName="isActive"
                (ngModelChange)="isEqual()"
                [checked]="form?.controls?.isActive?.value"
                labelPosition="before"
                >Activar/Inactivar</mat-slide-toggle
              >
              <div>
                Estatus:
                {{ form?.controls?.isActive?.value ? "Activo" : "Inactivo" }}
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="d-flex">
                <button
                  mat-icon-button
                  matPrefix
                  color="primary"
                  (click)="wareHouseNew($event)"
                  [disabled]="!factorySelected"
                >
                  <mat-icon>add</mat-icon>
                </button>
                <mat-form-field class="w-100" appearance="standard">
                  <mat-label>Nave</mat-label>
                  <mat-select (selectionChange)="isEqual()" formControlName="warehouseId" required>
                    <mat-option
                      *ngFor="let item of warehouseDataSource"
                      [value]="item.id"
                    >
                      {{ item?.name }}
                    </mat-option>
                  </mat-select>
                  <mat-error> {{appMessage.FIELD_REQUIRED}} </mat-error>
                </mat-form-field>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <mat-form-field fxFlex="grow" appearance="standard">
                <mat-label>Comentarios:</mat-label>
                <textarea (ngModelChange)="isEqual()" formControlName="comment" matInput rows="5"></textarea>
              </mat-form-field>
            </div>
            <div class="col-12">
              <div class="my-3 text-center">
                <button
                  type="submit"
                  color="primary"
                  mat-raised-button
                  [disabled]="isEdit ? form.invalid || isFormChange : form.invalid"
                >
                  <mat-icon>save</mat-icon>
                  <span> GUARDAR</span>
                </button>
              </div>
            </div>
            <div class="col-12">
              <span class="form-subtitle">*Datos obligatorios para el registro.</span>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
